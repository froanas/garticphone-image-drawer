{"version":3,"sources":["webpack://garticphone-image-drawer/./src/lib/react-trigger-change.js","webpack://garticphone-image-drawer/webpack/bootstrap","webpack://garticphone-image-drawer/webpack/runtime/compat get default export","webpack://garticphone-image-drawer/webpack/runtime/define property getters","webpack://garticphone-image-drawer/webpack/runtime/hasOwnProperty shorthand","webpack://garticphone-image-drawer/webpack/runtime/node module decorator","webpack://garticphone-image-drawer/./src/utils/wait-utils.js","webpack://garticphone-image-drawer/./src/index.js","webpack://garticphone-image-drawer/./src/ui-injector.js","webpack://garticphone-image-drawer/./src/painter-view.js","webpack://garticphone-image-drawer/./src/painter.js"],"names":["factory","modules","installedModules","__webpack_require__","moduleId","exports","module","i","l","call","m","c","value","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","node","event","descriptor","initialValue","eventName","options","deletePropertySafe","elem","prop","desc","getOwnPropertyDescriptor","getNextColor","color","newColor","parseInt","substr","toString","document","createEvent","initEvent","dispatchEvent","propertyName","MouseEvent","bubbles","define","__webpack_module_cache__","id","loaded","__webpack_modules__","a","definition","key","obj","nmd","paths","children","awaitNextTick","Promise","res","requestAnimationFrame","undefined","view","querySelector","CONTAINER_SELECTOR","prepend","root","this","painter","input","text","button","innerText","url","getInputValue","isInProgress","requestStop","setButtonText","drawImage","console","trace","alert","createElement","placeholder","style","addEventListener","onClick","passive","append","removeEventListener","initInputElement","initButtonElement","initRootElement","hexColor","colorInput","COLOR_INPUT_SELECTOR","Error","reactTriggerEvent","THICKNESS_SELECTOR","click","PEN_TOOL_SELECTOR","width","height","fetch","blob","imageBlob","image","Image","resolve","onload","newImgBlob","URL","createObjectURL","src","imgBlob","revokeObjectURL","canvas","naturalWidth","naturalHeight","ctx","getContext","imageData","getImageData","x","y","globalX","globalY","clientX","clientY","movementX","movementY","offsetX","offsetY","pageX","pageY","screenX","screenY","window","selectPencilTool","loadImageData","data","CANVAS_SELECTOR","getBoundingClientRect","top","left","length","stopRequested","r","padStart","g","b","setColor","pixelIdx","Math","floor","canvasX","canvasY","drawPoint","inject"],"mappings":"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","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\r\n  if (typeof exports === \"object\" && typeof module === \"object\")\r\n    module.exports = factory();\r\n  else if (typeof define === \"function\" && define.amd) define([], factory);\r\n  else if (typeof exports === \"object\")\r\n    exports[\"reactTriggerEvent\"] = factory();\r\n  else root[\"reactTriggerEvent\"] = factory();\r\n})(this, function () {\r\n  return /******/ (function (modules) {\r\n    // webpackBootstrap\r\n    /******/ // The module cache\r\n    /******/ var installedModules = {}; // The require function\r\n    /******/\r\n    /******/ /******/ function __webpack_require__(moduleId) {\r\n      /******/\r\n      /******/ // Check if module is in cache\r\n      /******/ if (installedModules[moduleId])\r\n        /******/ return installedModules[moduleId].exports; // Create a new module (and put it into the cache)\r\n      /******/\r\n      /******/ /******/ var module = (installedModules[moduleId] = {\r\n        /******/ i: moduleId,\r\n        /******/ l: false,\r\n        /******/ exports: {},\r\n        /******/\r\n      }); // Execute the module function\r\n      /******/\r\n      /******/ /******/ modules[moduleId].call(\r\n        module.exports,\r\n        module,\r\n        module.exports,\r\n        __webpack_require__\r\n      ); // Flag the module as loaded\r\n      /******/\r\n      /******/ /******/ module.l = true; // Return the exports of the module\r\n      /******/\r\n      /******/ /******/ return module.exports;\r\n      /******/\r\n    } // expose the modules object (__webpack_modules__)\r\n    /******/\r\n    /******/\r\n    /******/ /******/ __webpack_require__.m = modules; // expose the module cache\r\n    /******/\r\n    /******/ /******/ __webpack_require__.c = installedModules; // identity function for calling harmony imports with the correct context\r\n    /******/\r\n    /******/ /******/ __webpack_require__.i = function (value) {\r\n      return value;\r\n    }; // define getter function for harmony exports\r\n    /******/\r\n    /******/ /******/ __webpack_require__.d = function (exports, name, getter) {\r\n      /******/ if (!__webpack_require__.o(exports, name)) {\r\n        /******/ Object.defineProperty(exports, name, {\r\n          /******/ configurable: false,\r\n          /******/ enumerable: true,\r\n          /******/ get: getter,\r\n          /******/\r\n        });\r\n        /******/\r\n      }\r\n      /******/\r\n    }; // getDefaultExport function for compatibility with non-harmony modules\r\n    /******/\r\n    /******/ /******/ __webpack_require__.n = function (module) {\r\n      /******/ var getter =\r\n        module && module.__esModule\r\n          ? /******/ function getDefault() {\r\n              return module[\"default\"];\r\n            }\r\n          : /******/ function getModuleExports() {\r\n              return module;\r\n            };\r\n      /******/ __webpack_require__.d(getter, \"a\", getter);\r\n      /******/ return getter;\r\n      /******/\r\n    }; // Object.prototype.hasOwnProperty.call\r\n    /******/\r\n    /******/ /******/ __webpack_require__.o = function (object, property) {\r\n      return Object.prototype.hasOwnProperty.call(object, property);\r\n    }; // __webpack_public_path__\r\n    /******/\r\n    /******/ /******/ __webpack_require__.p = \"\"; // Load entry module and return exports\r\n    /******/\r\n    /******/ /******/ return __webpack_require__((__webpack_require__.s = 0));\r\n    /******/\r\n  })(\r\n    /************************************************************************/\r\n    /******/ [\r\n      /* 0 */\r\n      /***/ function (module, exports, __webpack_require__) {\r\n        \"use strict\";\r\n        // Trigger React's synthetic events on input, textarea and select elements\r\n        // https://github.com/facebook/react/pull/4051 - React 15 fix\r\n        // https://github.com/facebook/react/pull/5746 - React 16 fix\r\n\r\n        // Constants and functions are declared inside the closure.\r\n        // In this way, reactTriggerEvent can be passed directly to executeScript in Selenium.\r\n        module.exports = function reactTriggerEvent(\r\n          node,\r\n          eventName = \"change\",\r\n          options = {}\r\n        ) {\r\n          var event;\r\n          var descriptor;\r\n          var initialValue;\r\n\r\n          // Do not try to delete non-configurable properties.\r\n          // Value and checked properties on DOM elements are non-configurable in PhantomJS.\r\n          function deletePropertySafe(elem, prop) {\r\n            var desc = Object.getOwnPropertyDescriptor(elem, prop);\r\n            if (desc && desc.configurable) {\r\n              delete elem[prop];\r\n            }\r\n          }\r\n\r\n          function getNextColor(color) {\r\n            var newColor = `#${(parseInt(color.substr(1), 16) + 1).toString(\r\n              16\r\n            )}`;\r\n\r\n            return newColor === \"#1000000\" ? \"#000000\" : newColor;\r\n          }\r\n\r\n          if (eventName === \"change\") {\r\n            // React 16\r\n            // Cache artificial value property descriptor.\r\n            // Property doesn't exist in React <16, descriptor is undefined.\r\n            descriptor = Object.getOwnPropertyDescriptor(node, \"value\");\r\n\r\n            // React 0.14: IE9\r\n            // React 15: IE9-IE11\r\n            // React 16: IE9\r\n            // Dispatch focus.\r\n            event = document.createEvent(\"UIEvents\");\r\n            event.initEvent(\"focus\", false, false);\r\n            node.dispatchEvent(event);\r\n\r\n            // React 0.14: IE9\r\n            // React 15: IE9-IE11\r\n            // React 16\r\n            // In IE9-10 imperative change of node value triggers propertychange event.\r\n            // Update inputValueTracking cached value.\r\n            // Remove artificial value property.\r\n            // Restore initial value to trigger event with it.\r\n            initialValue = node.value;\r\n            // node.value = initialValue + \"#\";\r\n            node.value = getNextColor(initialValue);\r\n            deletePropertySafe(node, \"value\");\r\n            node.value = initialValue;\r\n\r\n            // React 15: IE11\r\n            // For unknown reason React 15 added listener for propertychange with addEventListener.\r\n            // This doesn't work, propertychange events are deprecated in IE11,\r\n            // but allows us to dispatch fake propertychange which is handled by IE11.\r\n            event = document.createEvent(\"HTMLEvents\");\r\n            event.initEvent(\"propertychange\", false, false);\r\n            event.propertyName = \"value\";\r\n            node.dispatchEvent(event);\r\n\r\n            // React 0.14: IE10-IE11, non-IE\r\n            // React 15: non-IE\r\n            // React 16: IE10-IE11, non-IE\r\n            event = document.createEvent(\"HTMLEvents\");\r\n            event.initEvent(\"input\", true, false);\r\n            node.dispatchEvent(event);\r\n\r\n            // React 16\r\n            // Restore artificial value property descriptor.\r\n            if (descriptor) {\r\n              Object.defineProperty(node, \"value\", descriptor);\r\n            }\r\n          } else {\r\n            // Handle other mouse event types\r\n            event = new MouseEvent(eventName, { bubbles: true, ...options });\r\n            node.dispatchEvent(event);\r\n          }\r\n        };\r\n\r\n        /***/\r\n      },\r\n      /******/\r\n    ]\r\n  );\r\n});\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\tloaded: false,\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Flag the module as loaded\n\tmodule.loaded = true;\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => module['default'] :\n\t\t() => module;\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop)","__webpack_require__.nmd = (module) => {\n\tmodule.paths = [];\n\tif (!module.children) module.children = [];\n\treturn module;\n};","const DRAW_CALLS_PER_RENDER = 500;\r\n\r\nexport const awaitNextTick = (i) =>\r\n  i % DRAW_CALLS_PER_RENDER === 0\r\n    ? new Promise((res) => requestAnimationFrame(res))\r\n    : undefined;\r\n","import Painter from \"./painter\";\r\nimport PainterView from \"./painter-view\";\r\nimport UIInjector from \"./ui-injector\";\r\n\r\nconst painter = new Painter();\r\nconst painterView = new PainterView(painter);\r\nconst uiInjector = new UIInjector(painterView);\r\n\r\nuiInjector.inject();\r\n","export default class UIInjector {\r\n  CONTAINER_SELECTOR = \"#content\";\r\n\r\n  constructor(view) {\r\n    this.view = view;\r\n  }\r\n\r\n  inject = () => {\r\n    const container = document.querySelector(this.CONTAINER_SELECTOR);\r\n    container.prepend(this.view.root);\r\n  };\r\n}\r\n","export default class PainterView {\r\n  constructor(painter) {\r\n    this.painter = painter;\r\n\r\n    this.initInputElement();\r\n    this.initButtonElement();\r\n    this.initRootElement();\r\n  }\r\n\r\n  getInputValue = () => {\r\n    return this.input.value;\r\n  };\r\n\r\n  setButtonText = (text) => {\r\n    this.button.innerText = text;\r\n  };\r\n\r\n  onClick = async () => {\r\n    const url = this.getInputValue();\r\n\r\n    if (this.painter.isInProgress) {\r\n      this.painter.requestStop();\r\n      return;\r\n    }\r\n\r\n    if (!url) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      this.setButtonText(\"Stop\");\r\n      await this.painter.drawImage(url);\r\n    } catch (e) {\r\n      console.trace(e);\r\n      alert(\"Sorry an error occured while processing the image.\");\r\n    } finally {\r\n      this.setButtonText(\"Draw!\");\r\n    }\r\n  };\r\n\r\n  initInputElement = () => {\r\n    this.input = document.createElement(\"input\");\r\n    this.input.placeholder = \"Image URL\";\r\n    this.input.style = \"min-width: 200px;\";\r\n  };\r\n\r\n  initButtonElement = () => {\r\n    this.button = document.createElement(\"button\");\r\n    this.button.innerText = \"Draw!\";\r\n    this.button.style = \"margin-left: 1rem\";\r\n    this.button.addEventListener(\"click\", this.onClick, { passive: true });\r\n  };\r\n\r\n  initRootElement = () => {\r\n    this.root = document.createElement(\"div\");\r\n    this.root.append(this.input);\r\n    this.root.append(this.button);\r\n    this.root.style = \"display: flex;position: absolute;top: 1rem;right: 1rem\";\r\n  };\r\n\r\n  dispose = () => {\r\n    this.button.removeEventListener(\"click\", this.onClick);\r\n  };\r\n}\r\n","import reactTriggerEvent from \"./lib/react-trigger-change\";\r\nimport { awaitNextTick } from \"./utils/wait-utils\";\r\n\r\nexport default class Painter {\r\n  COLOR_INPUT_SELECTOR = '.draw input[type=\"color\"]';\r\n  THICKNESS_SELECTOR = \".draw .options > div > div\";\r\n  PEN_TOOL_SELECTOR = \".draw .tool.pen\";\r\n  CANVAS_SELECTOR = \".draw .core canvas:last-child\";\r\n\r\n  color = \"#000000\";\r\n  isLoading = false;\r\n  stopRequested = false;\r\n\r\n  setColor = (hexColor) => {\r\n    const colorInput = document.querySelector(this.COLOR_INPUT_SELECTOR);\r\n\r\n    if (!colorInput) {\r\n      throw new Error(\"Color input not found\");\r\n    }\r\n\r\n    colorInput.value = hexColor;\r\n    this.color = hexColor;\r\n\r\n    reactTriggerEvent(colorInput, \"change\");\r\n  };\r\n\r\n  selectPencilTool = () => {\r\n    // Select thickness\r\n    document.querySelector(this.THICKNESS_SELECTOR)?.click();\r\n    // Select tool\r\n    document.querySelector(this.PEN_TOOL_SELECTOR)?.click();\r\n  };\r\n\r\n  loadImageData = async (url, width, height) => {\r\n    try {\r\n      const res = await fetch(url);\r\n      const imageBlob = await res.blob();\r\n\r\n      // Using optional size for image\r\n      const image = new Image(width, height);\r\n\r\n      await new Promise((resolve) => {\r\n        image.onload = resolve;\r\n\r\n        // Create a local URL for that image and print it\r\n        const newImgBlob = URL.createObjectURL(imageBlob);\r\n        image.src = newImgBlob;\r\n\r\n        if (this.imgBlob) {\r\n          URL.revokeObjectURL(this.imgBlob);\r\n          this.imgBlob = newImgBlob;\r\n        }\r\n      });\r\n\r\n      const canvas = document.createElement(\"canvas\", {\r\n        width: image.naturalWidth,\r\n        height: image.naturalHeight,\r\n      });\r\n\r\n      const ctx = canvas.getContext(\"2d\");\r\n      ctx.drawImage(image, 0, 0);\r\n      const imageData = ctx.getImageData(\r\n        0,\r\n        0,\r\n        image.naturalWidth,\r\n        image.naturalHeight\r\n      );\r\n\r\n      return imageData;\r\n    } catch (e) {\r\n      throw e;\r\n    }\r\n  };\r\n\r\n  drawPoint = async (x, y, globalX, globalY, i) => {\r\n    const options = {\r\n      clientX: globalX,\r\n      clientY: globalY,\r\n      movementX: 0,\r\n      movementY: 0,\r\n      offsetX: x,\r\n      offsetY: y,\r\n      pageX: globalX,\r\n      pageY: globalY,\r\n      screenX: globalX,\r\n      screenY: globalY + 3,\r\n      x: globalX,\r\n      y: globalY,\r\n      view: window,\r\n    };\r\n\r\n    reactTriggerEvent(this.canvas, \"mousedown\", options);\r\n    await awaitNextTick(i);\r\n    reactTriggerEvent(this.canvas, \"mouseup\", options);\r\n    await awaitNextTick(i);\r\n  };\r\n\r\n  drawImage = async (url) => {\r\n    try {\r\n      this.isInProgress = true;\r\n\r\n      this.selectPencilTool();\r\n      const { data, width } = await this.loadImageData(url);\r\n\r\n      this.canvas = document.querySelector(this.CANVAS_SELECTOR);\r\n      const { top, left } = this.canvas.getBoundingClientRect();\r\n\r\n      for (let i = 0; i < data.length; i += 4) {\r\n        if (this.stopRequested) {\r\n          break;\r\n        }\r\n\r\n        const r = data[i].toString(16).padStart(2, \"0\");\r\n        const g = data[i + 1].toString(16).padStart(2, \"0\");\r\n        const b = data[i + 2].toString(16).padStart(2, \"0\");\r\n\r\n        // Skip Alpha for now\r\n        // const a = data[i+3].toString(16).padStart(2,\"0\");\r\n\r\n        const newColor = `#${r}${g}${b}`;\r\n\r\n        if (this.color !== newColor) {\r\n          this.setColor(newColor);\r\n          await awaitNextTick(i);\r\n        }\r\n\r\n        const pixelIdx = Math.floor(i / 4);\r\n        const canvasX = pixelIdx % width;\r\n        const canvasY = Math.floor(pixelIdx / width);\r\n        await this.drawPoint(\r\n          canvasX,\r\n          canvasY,\r\n          left + canvasX + 3,\r\n          top + canvasY,\r\n          i\r\n        );\r\n      }\r\n    } catch (e) {\r\n      throw e;\r\n    } finally {\r\n      this.canvas = null;\r\n      this.isInProgress = false;\r\n      this.stopRequested = false;\r\n    }\r\n  };\r\n\r\n  requestStop = () => {\r\n    if (this.isInProgress) {\r\n      this.stopRequested = true;\r\n    }\r\n  };\r\n}\r\n"],"sourceRoot":""}